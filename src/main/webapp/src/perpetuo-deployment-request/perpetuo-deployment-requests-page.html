<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../perpetuo-client/perpetuo-client.html">
<link rel="import" href="../perpetuo-deployment-request/perpetuo-deployment-request.html">
<link rel="import" href="../perpetuo-deployment-request/perpetuo-deployment-request-table.html">

<dom-module id="perpetuo-deployment-requests-page">
  <template>
    <style>
    :host {
      display: flex;
      flex-direction: row;
    }
    app-route {
      display: none;
    }
    #pageSelector {
      flex: 1;
    }
    </style>
    <iron-pages id="pageSelector" selected="[[selectPage(route)]]" fallback-selection="single" attr-for-selected="id">
      <div id="all">
        <perpetuo-deployment-request-table></perpetuo-deployment-request-table>
      </div>
      <div id="single">
        <perpetuo-deployment-request></perpetuo-deployment-request>
      </div>
    </iron-pages>
  </template>
  <script>
  Polymer({
    is: 'perpetuo-deployment-requests-page',

    properties: {
      selected: { type: Number, value: 0 },

      route: { type: Object }
    },

    selectPage(route) {
      if (route.path) {
        const m = route.path.match(new RegExp('/(\\d+)'))
        if (m) {
          this.client.fetchDeploymentRequest(m[1]).then(_ => this.$$('#single perpetuo-deployment-request').data = _);
          return 'single';
        }
      }
      return 'all';
    },

    created() {
      this.client = new Perpetuo.Client();
    },
  });
  </script>
</dom-module>
