<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">

<script>
function arrayifyTargetStatus(targetStatusMap) {
  return Object.keys(targetStatusMap).map(targetAtom => {
    const targetAtomStatus = targetStatusMap[targetAtom];
    return { targetAtom: targetAtom, code: targetAtomStatus.code, detail: targetAtomStatus.detail };
  });
}
</script>

<dom-module id="perpetuo-deployment-operation">
  <style>
  :host {
    padding: 1em;
    display: flex;
    flex-direction: column;
    --paper-tabs-container: {
      display: table;
    }
    --paper-tabs-selection-bar-color: #007acc;
    --paper-tab-ink: #007acc;
    --paper-tab-content: {
      text-transform: uppercase;
      font-size: 12px;
    }
  }

  p {
    margin-top: 0;
    font-size: 20px;
    color: hsl(0,0%,13%);
    text-transform: capitalize;
  }

  .target-status {
    width: 100%;
    border-collapse: collapse;
  }
  .target-status th {
    font-weight: 500;
    color: #757575;
    text-align: left;
  }
  .target-status td {
    color: hsl(0,0%,13%);
  }
  .target-status tr {
    line-height: 42px;
    border-bottom: solid 1px #ddd;
  }
  .target-status tr :first-child {
    padding-left: 24px;
  }
  .target-status tbody tr:last-of-type {
    border: 0;
  }
  .target-status td:not(:last-child) {
    padding-right: 56px;
  }
  .target-status tbody tr:hover {
    background-color: #eee;
  }
  </style>
  <template>
    <p>Operation: [[type]]</p>
    <paper-tabs selected="{{selected}}">
      <paper-tab>Summary</paper-tab>
      <paper-tab>Logs</paper-tab>
    </paper-tabs>
    <iron-pages selected="{{selected}}">
      <table class="target-status">
        <thead>
          <tr><th>Target</th><th>Status</th><th>Detail</th></tr>
        </thead>
        <tbody>
          <template is="dom-repeat" items="[[targetStatus]]">
            <tr><td>[[item.targetAtom]]</td><td>[[item.code]]</td><td>[[item.detail]]</td></tr>
          </template>
        </tbody>
      </table>
      <ul class="executions">
        <template is="dom-repeat" items="[[executions]]">
          <li>
          <span>[[item.state]]</span>
          <a hidden$="[[!item.logHref]]" href$="[[item.logHref]]">Logs...</a>
          </li>
        </template>
      </ul>
    </iron-pages>
  </template>
  <script>
  Polymer({
    is: 'perpetuo-deployment-operation',

    properties: {
      selected: { type: Number, value: 0 },

      data: { type: Object, value: () => {}, observer: 'onDataChanged' },

      targetStatus: { type: Array, value: () => [] },
      type: { type: String },
      executions: { type: Array, value: () => [] }
    },

    onDataChanged(data) {
      this.targetStatus = arrayifyTargetStatus(data.targetStatus);
      this.type = data.type;
      this.executions = data.executions;
    },
  });
  </script>
</dom-module>
